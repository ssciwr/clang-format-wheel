name: Build + Release Wheels

on:
  push:

jobs:
  build-wheels:
    name: "${{ matrix.os }} :: ${{ matrix.platform }}-${{ matrix.arch }}"
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        include:
          - os: windows-latest
            platform: "win"
            arch: "AMD64"

    steps:
    - uses: actions/checkout@v4
    
    - name: Support long paths
      if: runner.os == 'Windows'
      run: git config --system core.longpaths true

    - name: Set up msvc on Windows
      if: runner.os == 'Windows'
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: ${{ matrix.arch }}
        toolset: "14.0"

    - name: Build wheels
      uses: pypa/cibuildwheel@v2.18
      env:
        CIBW_ARCHS: "${{ matrix.arch }}"
        # restrict to a single Python version as wheel does not depend on Python:
        CIBW_BUILD: "cp311-${{ matrix.platform }}*"
